#!/usr/bin/env bash
set -euo pipefail

die() {
  echo "pre-push: $*" >&2
  exit 1
}

repo_root="$(git rev-parse --show-toplevel 2>/dev/null || true)"
if [[ -z "${repo_root}" ]]; then
  exit 0
fi

cd "${repo_root}"

if [[ "${SECONDLOOP_PRE_PUSH_FULL:-0}" == "1" ]]; then
  bash .githooks/pre-commit --check --ci
  exit 0
fi

echo "pre-push: skipped (checks moved to pre-commit)."
echo "pre-push: set SECONDLOOP_PRE_PUSH_FULL=1 to run full pre-push verification."
